<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="TesterCC">
  <link rel="canonical" href="https://testercc.github.io/backend/database/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Database 数据库 - Security Development Notes</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Database \u6570\u636e\u5e93";
    var mkdocs_page_input_path = "backend\\database.md";
    var mkdocs_page_url = "/backend/database/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/ruby.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/php.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Security Development Notes</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">About the Notes 关于笔记</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Security Development 安全研发</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/learn_guide/">学习指南</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/term/">相关术语</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/sec_dev_lifecycle/">SDL 安全开发流程</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/code_sec/">Code Security 代码安全</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/log_audit/">Log Audit 日志审计</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/open_source/">Opensource 开源项目推荐</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/skill_tree/">Skill Tree 技能树</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/zero_trust/">Zero Trust 零信任网络</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/dev_sec_ops/">DevSecOps</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/enterprise_security/">Enterprise Security 企业安全</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/intelligent_risk_control/">Intelligent Risk Control 智能风控</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../secdev/ai_sec/">AI Sec 人工智能安全</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Security Research 安全研究</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../sec_research/research_list/">导航列表</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../sec_research/sample_analysis/">样本分析</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../sec_research/black_market/">黑产研究</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../sec_research/python_sec/">Python安全</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../sec_research/block_chain_sec/">区块链安全</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../sec_research/android_sec/">Android安全</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Incident Response 应急响应</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../incident_response/learn_guide/">学习参考</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Pentest 渗透测试</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/learn_guide/">学习参考</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/term/">Term 术语</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/brute_force/">Brute Force 暴力破解</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/sql_injection/">SQL Injection SQL注入</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/ddos/">DDoS 分布式拒绝服务</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/xss/">XSS 跨站脚本攻击</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/csrf/">CSRF 跨站请求伪造</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/privilge_escalation/">Privilge Escalation 提权</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/re/">Reverse Engineering 逆向工程</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/attack_lifecycle/">网络攻击生命周期</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/cve/">CVE</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../pentest/report/">报告和笔记</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">CTF</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../ctf/learn_guide/">基础知识</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ctf/attack_and_defence/">实战攻防演练</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ctf/env_config/">测试环境搭建</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ctf/ctf_skill/">CTF竞赛常用基本解题技巧</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ctf/pwn/">PWN</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Algorithm 算法</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../algorithm/learn_guide/">学习指南</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Architecture 架构</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../architecture/learn_guide/">学习指南</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../architecture/design_pattern/">Design Pattern 设计模式</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../architecture/ddd/">DDD 领域驱动设计</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../architecture/micro_services/">Micro Services 微服务</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../architecture/scrum/">Scrum</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Back-end Development 后端开发</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="../learn_guide/">学习指南</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../computer_networking/">计算机网络</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../os/">OS 操作系统</a>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="./">Database 数据库</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#mysql">Mysql</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#redis">Redis</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#1-ubunturedis">1. Ubuntu安装redis</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#apt">apt安装</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#_2">手动安装 （不推荐）</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#2-redis-on-ubuntu">2. Redis常用命令 （on Ubuntu）</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#3redis">3.Redis问题解决</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#1-overcommit_memory">1. overcommit_memory</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#2-thptransparent-huge-pages">2. THP（Transparent Huge Pages）透明大页</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#3-tcp-backlog">3. TCP backlog</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#redis_1">Redis主从复制</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#mongodb">MongoDB</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#postgresql">PostgreSQL</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#_3">其他问题</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#_4">关系型数据库数据搜索缺点</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_5">如何对数据库进行优化</a>
    </li>
        </ul>
    </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../performance_optimization/">性能优化</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rpc/">RPC</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../search_engine/">搜索引擎</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../high_concurrency/">高并发</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../python/">Python</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../go/">Golang</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../java/">Java</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rust/">Rust</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../proxy/">Proxy 代理</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../rabbitmq/">RabbitMQ</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../kafka/">Kafka</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../big_data/">Big Data 大数据</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../git/">Git</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../git_flow/">Git Flow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../shell/">Shell</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../vim/">Vim</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Machine Learning 机器学习</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../machine_learning/machine_learning/">机器学习</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../machine_learning/nlp/">自然语言处理</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../machine_learning/statistical_learning/">统计学习方法笔记</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Front-end Development 前端开发</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../frontend/learn_guide/">学习指南</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../frontend/html5/">HTML5</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../frontend/css/">CSS</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../frontend/js/">JavaScript</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../frontend/vue/">Vue.js</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../frontend/react/">React</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">MOOC Notes 幕课笔记</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../mooc_notes/pku_datastructure/">数据结构与算法Python版</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../mooc_notes/CS_basic/">编程必备基础知识</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Test Development 测试开发</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../testdev/learn_guide/">学习指南</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">软考</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../ruankao/ruankao/">考试相关信息</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ruankao/system_analyst/">高级系统分析师复习笔记</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../ruankao/system_architect/">高级系统架构设计师复习笔记</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">爬虫开发</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../crawler/cookie_pool/">Cookie池设计</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">DevOps</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../devops/learn_guide/">学习指南</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../devops/docker/">Docker</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../devops/sre/">SRE</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">SEO 搜索引擎优化</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../seo/knowledge/">基本知识</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seo/whitehat_seo/">白帽SEO</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../seo/blackhat_seo/">黑帽SEO</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Interview 面试</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../interview/navigation/">Navigation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../interview/security/">Security Interview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../interview/backend/">Backend Interview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../interview/ai/">AI Interview</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../interview/qa/">QA Interview</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Academic 学术</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../academic/academic/">Information 相关信息</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Math 数学</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../math/learn_guide/">学习参考</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Others</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../others/introduce/">简介</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../others/learning_view/">Learning View 学习观</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../others/reading_radar/">Reading Radar 读书雷达</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../others/foreign_language/">Foreign Language 外语</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../others/law/">Law 法律</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../others/hexo/">Hexo</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../others/english_grammar/">英语语法框架</a>
                    </li>
                </ul>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../todo_list/">Todo List</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Security Development Notes</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Back-end Development 后端开发 &raquo;</li>
        
      
    
    <li>Database 数据库</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="_1">数据库相关</h1>
<p>简单记录各中数据库常用crud命令。</p>
<h2 id="mysql">Mysql</h2>
<p>默认端口：<code>3306</code></p>
<ul>
<li><code>查询是否锁表</code></li>
</ul>
<pre><code>mysql&gt; show processlist;
+-----------+----------+--------------------+------------+---------+-------+-------+------------------+
| Id        | User     | Host               | db         | Command | Time  | State | Info             |
+-----------+----------+--------------------+------------+---------+-------+-------+------------------+
| 725067379 | mytestdb | 10.10.XX.15:35790  | test_event | Sleep   | 21286 |       | NULL             |
| 725362450 | mytestdb | 10.10.XX.15:39726  | test_event | Sleep   | 13862 |       | NULL             |
| 725816007 | mytestdb | 10.10.XX.222:49839 | test_event | Query   |     0 | NULL  | show processlist |
| 725822632 | mytestdb | 10.10.XX.15:58585  | test_event | Sleep   |     2 |       | NULL             |
| 725822668 | mytestdb | 10.10.XX.15:58660  | test_event | Sleep   |     0 |       | NULL             |
| 725822669 | mytestdb | 10.10.XX.15:58661  | test_event | Sleep   |     0 |       | NULL             |
| 725822671 | mytestdb | 10.10.XX.15:58666  | test_event | Sleep   |     0 |       | NULL             |
| 725822674 | mytestdb | 10.10.XX.15:58673  | test_event | Sleep   |     0 |       | NULL             |
| 725822675 | mytestdb | 10.10.XX.15:58677  | test_event | Sleep   |     0 |       | NULL             |
+-----------+----------+--------------------+------------+---------+-------+-------+------------------+
9 rows in set (0.00 sec)
</code></pre>

<ul>
<li><code>查询表中数据总数</code> -- Innod数据量过大这样查询速度很慢，需要给表加索引</li>
</ul>
<pre><code>mysql&gt; select count(*) from dev_company_tax;
+----------+
| count(*) |
+----------+
| 12542793 |
+----------+
1 row in set (4.12 sec)
</code></pre>

<ul>
<li><code>查询某张表的索引</code></li>
</ul>
<pre><code>mysql&gt; show index from test_company_tax;
+-----------------+------------+-------------------+--------------+-----------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| Table           | Non_unique | Key_name          | Seq_in_index | Column_name     | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |
+-----------------+------------+-------------------+--------------+-----------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
| dev_company_tax |          0 | PRIMARY           |            1 | id              | A         |    12787231 |     NULL | NULL   |      | BTREE      |         |               |
| dev_company_tax |          1 | tax_number        |            1 | tax_number      | A         |    12787231 |     NULL | NULL   |      | BTREE      |         |               |
| dev_company_tax |          1 | isshow            |            1 | isshow          | A         |          20 |     NULL | NULL   |      | BTREE      |         |               |
| dev_company_tax |          1 | is_img_ok         |            1 | is_img_ok       | A         |          20 |     NULL | NULL   |      | BTREE      |         |               |
| dev_company_tax |          1 | is_img_ok_2       |            1 | is_img_ok       | A         |          20 |     NULL | NULL   |      | BTREE      |         |               |
| dev_company_tax |          1 | is_img_qichacha   |            1 | is_img_qichacha | A         |          20 |     NULL | NULL   |      | BTREE      |         |               |
| dev_company_tax |          1 | is_img_qichacha_2 |            1 | is_img_qichacha | A         |          20 |     NULL | NULL   |      | BTREE      |         |               |
+-----------------+------------+-------------------+--------------+-----------------+-----------+-------------+----------+--------+------+------------+---------+---------------+
7 rows in set (0.34 sec)

extend:

通过MySQL命令查看
show index from tbname;

MySQL通过SQL语句查看表的索引：
1、查看数据库所有索引

SELECT * FROM mysql.`innodb_index_stats` a WHERE a.`database_name` = '数据库名';

2、查看某一表索引

SELECT * FROM mysql.`innodb_index_stats` a WHERE a.`database_name` = '数据库名' and a.table_name like '%表名%';

</code></pre>

<h2 id="redis">Redis</h2>
<p>默认端口：<code>6379</code></p>
<p>能系统安装就不要自己手动装了。</p>
<h3 id="1-ubunturedis">1. Ubuntu安装redis</h3>
<h4 id="apt">apt安装</h4>
<pre><code>sudo apt-get install redis-server
</code></pre>

<h4 id="_2">手动安装 （不推荐）</h4>
<p>(详见此文)[https://jingyan.baidu.com/article/00a07f38173cea82d028dc24.html]</p>
<pre><code>下载：wget http://download.redis.io/releases/redis-3.0.6.tar.gz

解压：tar -zxvf redis-3.0.6.tar.gz

编译：cd redis-3.0.6 &amp;&amp; make MALLOC=libc

安装：sudo make install
</code></pre>

<h3 id="2-redis-on-ubuntu">2. Redis常用命令 （on Ubuntu）</h3>
<p>一般来说，会在redis安装目录下面，配置一个redis.conf的文件来定制化启动redis</p>
<pre><code>检查Redis是否挂了
ps -ef | grep redis

test@xxx:/data/$ ps -ef | grep redis
ubuntu    6673     1  0  8月19 ?      01:59:52 redis-server *:6379
</code></pre>

<pre><code>1.Redis server 6379挂了时，启动reids (带启动文件)

进入redis安装目录

执行下面命令的其中1条：
sudo redis-server redis.conf
sudo ./redis-server  ./redis.conf

2.Redis server 没挂时，重启redis

sudo service redis-server restart
sudo /etc/init.d/redis-server restart

or

sudo systemctl restart redis-server   (apt或yum安装的redis)



[sudo] password for ubuntu:
Stopping redis-server: redis-server.
Starting redis-server: redis-server.
</code></pre>

<p>如果是用apt-get或者yum install安装的redis，可以直接通过下面的命令停止/启动/重启redis.</p>
<pre><code>/etc/init.d/redis-server stop
/etc/init.d/redis-server start
/etc/init.d/redis-server restart
</code></pre>

<h3 id="3redis">3.Redis问题解决</h3>
<p><a href="http://vearne.cc/archives/158">REDIS 启动警告及处理 -- 推荐</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1044436">redis超时原因系统性排查</a></p>
<pre><code>1. overcommit_memory
2. THP (Transparent Huge Pages)
3. TCP backlog
</code></pre>

<h4 id="1-overcommit_memory">1. overcommit_memory</h4>
<p>错误日志：</p>
<p>ResponseError: MISCONF Redis is configured to save RDB snapshots, but is currently not able to persist on disk. Commands that may modify the data set are disabled. Please check Redis logs for details about the error.</p>
<p><a href="http://www.redicecn.com/html/Linux/20131125/468.html">参考解决方案</a></p>
<p><a href="http://blog.chinaunix.net/uid-30401178-id-5159439.html">解决实施参考</a></p>
<p>很多人都是建议“config set stop-writes-on-bgsave-error no”。这样做其实是不好的，这仅仅是让程序忽略了这个异常，使得程序能够继续往下运行，但实际上数据还是会存储到硬盘失败。</p>
<p>当操作系统收到内存分配请求时，它会依据overcommit_memory 设定的条件，考虑接受或者拒绝这个请求</p>
<pre><code>0 — 默认设置 内核使用启发式算法，来估算可用的内存量，直接拒绝不合理的请求
1 — 内核不考虑内存是否够用，直接同意请求，在这种设置下，潜在的内存过载风险增加了，但有利于内存密集型任务
2 — 如果程序请求的内存分配大于等于 交换分区和物理内存的总和 * overcommit_ratio / 100 则拒绝这个请求 默认是 交换分区和物理内存总和的50%
</code></pre>

<p>默认设置是0，只要内存请求超过物理内存的剩余量，请求就会被拒绝。
设置1，不管实际物理内存使用量，直接同意请求。设置1是一种比较粗放式的对内存请求的管理方式，我认为更为优雅的方式是使用2，并且将overcommit_ratio 的值设为60 ~ 80</p>
<p>解决方法：</p>
<p>细致式：</p>
<pre><code>echo &quot;vm.overcommit_memory=2&quot; &gt;&gt; /etc/sysctl.conf
echo &quot;vm.overcommit_ratio=70&quot; &gt;&gt; /etc/sysctl.conf
sysctl -p
</code></pre>

<p>sysctl -p 不用重启使配置生效</p>
<p>粗旷式：</p>
<pre><code>echo &quot;vm.overcommit_memory=1&quot; &gt;&gt; /etc/sysctl.conf
</code></pre>

<h4 id="2-thptransparent-huge-pages">2. THP（Transparent Huge Pages）透明大页</h4>
<p>透明大页，默认是always，启用是为了可以管理更多的内存地址空间。可以使用never关闭，之后会使用系统软件的算法管理内存映射。</p>
<pre><code>通常linux会将透明大页开启，在fork被调用后，redis产生的延迟被用来持久化到磁盘。内存大页会引起一下问题：
 1.fork被调用，共享内存大页的两个进程被创建
 2.在一个系统比较活跃的实例里，部分循环时间运行需要几千个内存页，期间引起的copy-on-write 会消耗几乎所有的内存
 3.这个将导致更大的延迟和使用更多的内存

因此，redis官方建议需要确保禁掉内存大页：
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
</code></pre>

<p>错误日志：</p>
<p>WARNING you have Transparent Huge Pages (THP) support enabled in your kernel. This will create latency and memory usage issues with Redis. To fix this issue run the command 'echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled' as root, and add it to your /etc/rc.local in order to retain the setting after a reboot. Redis must be restarted after THP is disabled.</p>
<p>使用的是透明大页，可能导致redis延迟和内存使用问题。</p>
<p>查看是否使用透明大页</p>
<pre><code>➜  cat /sys/kernel/mm/transparent_hugepage/enabled
always madvise [never]

Linux默认设置使[always]
</code></pre>

<p>解决使用的是透明大页，可能导致redis延迟和内存使用问题。</p>
<p>解决方法：</p>
<pre><code>临时解决方法

sudo su    #  先切换到root用户
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled     # root用户执行此命令

➜ cat /sys/kernel/mm/transparent_hugepage/enabled
always madvise [never]     # 选择的使never说明设置成功，默认是[always]



永久解决方法：

将其写入/etc/rc.local文件中：

iftest -f /sys/kernel/mm/redhat_transparent_hugepage/enabled; then

echo never &gt; /sys/kernel/mm/redhat_transparent_hugepage/enabled

fi
</code></pre>

<h4 id="3-tcp-backlog">3. TCP backlog</h4>
<p>常见报错：</p>
<pre><code># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.

# Server started, Redis version 3.2.6
</code></pre>

<p>对于linux 而言backlog 是指已经完成了3次握手，且等待 accept 的连接
如果被没有被accept, 连接会一直在队列中排队，队列的最大长度为 backlog
由此可知， 在client非常多且创建和关闭连接非常频繁的场景下，这个参数会非常有用。</p>
<p>解决方法：</p>
<pre><code>echo &quot;net.core.somaxconn = 511&quot; &gt;&gt; /etc/sysctl.conf
sysctl -p
</code></pre>

<h3 id="redis_1">Redis主从复制</h3>
<p><a href="https://www.iteye.com/blog/iluoxuan-1939870">redis的主从复制</a></p>
<h2 id="mongodb">MongoDB</h2>
<p>默认端口：<code>27017</code></p>
<p>常用命令：</p>
<pre><code>1.检查mongod启动没有
pgrep mongo -l

2.mongodb的后台启动，配置文件(mongodb.conf)自己写（能不用root就别用root），日志注意不要写到/var下
mongod --config /etc/mongodb.conf   
</code></pre>

<h2 id="postgresql">PostgreSQL</h2>
<p>默认端口：<code>5432</code></p>
<h2 id="_3">其他问题</h2>
<h3 id="_4">关系型数据库数据搜索缺点</h3>
<p>1.无法打分（无法对搜索出来的结果进行排序）</p>
<p>2.无分布式</p>
<p>3.无法解析搜索请求</p>
<p>4.效率低（上亿）</p>
<p>5.分词</p>
<h3 id="_5">如何对数据库进行优化</h3>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../performance_optimization/" class="btn btn-neutral float-right" title="性能优化">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../os/" class="btn btn-neutral" title="OS 操作系统"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../os/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../performance_optimization/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
